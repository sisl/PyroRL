<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://sisl.github.io/PyroRL/how-it-works/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>How It Works - PyroRL</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "How It Works";
        var mkdocs_page_input_path = "how-it-works.md";
        var mkdocs_page_url = "/PyroRL/how-it-works/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> PyroRL
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../quickstart/">Quickstart</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">How It Works</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#wildfire-evacuation-as-a-markov-decision-process">Wildfire Evacuation as a Markov Decision Process</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#overview-of-state-space">Overview of State Space</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#overview-of-action-space">Overview of Action Space</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#spread-of-wildfire">Spread of Wildfire</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#fuel">Fuel</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#fire-spread">Fire Spread</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#wind">Wind</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#custom-map-generation">Custom Map Generation</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#how-to-load-and-generate-maps">How to Load and Generate Maps</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#deep-dive-on-map-generation-implementation">Deep Dive on Map Generation Implementation</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../contribution-guide/">Contribution Guide</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../reference/">Reference</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">PyroRL</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">How It Works</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="how-it-works">How it works</h1>
<h2 id="wildfire-evacuation-as-a-markov-decision-process">Wildfire Evacuation as a Markov Decision Process</h2>
<h3 id="overview-of-state-space">Overview of State Space</h3>
<p>The state space is each possible configuration of the grid. Internally, this is represented as a <span class="arithmatex">\(5\)</span> by <span class="arithmatex">\(m\)</span> by <span class="arithmatex">\(n\)</span> tensor, where <span class="arithmatex">\(m\)</span> and <span class="arithmatex">\(n\)</span> represent the number of rows and columns of the grid world respectively. Each of the <span class="arithmatex">\(5\)</span> indices corresponds to a specific attribute:</p>
<ul>
<li><code>0 = FIRE_INDEX</code> – whether or not a square in the grid world is on fire or not</li>
<li><code>1 = FUEL_INDEX</code> – the amount of fuel in the square, which is used to determine if an area will be enflamed or not</li>
<li><code>2 = POPULATED_INDEX</code> – whether or not a square is a populated area or not</li>
<li><code>3 = EVACUATING_INDEX</code> – whether or not a square is evacuating or not</li>
<li><code>4 = PATHS_INDEX</code> – the number of paths a square is a part of</li>
</ul>
<h3 id="overview-of-action-space">Overview of Action Space</h3>
<p>The action space describes whether or not a populated area should evacuate. If evacuating, the agent must choose a specific populated area to evacuate, as well as a path from which to evacuate.</p>
<ul>
<li>Transition Model: determined by the stochastic nature of the wildfire implementation, which we describe below</li>
<li>Reward Model: <span class="arithmatex">\(+1\)</span> for every populated area that has not evacuated and is not ignited, and <span class="arithmatex">\(-100\)</span> if a populated area is burned down</li>
</ul>
<h3 id="spread-of-wildfire">Spread of Wildfire</h3>
<p>Finally, our stochastic wildfire model is based on <a href="https://arxiv.org/abs/1810.04244">prior work</a>:</p>
<h4 id="fuel">Fuel</h4>
<p>Each fire cell has an initial fuel level <span class="arithmatex">\(\sim \mathcal{N}(\mu, \, (\sigma)^{2})\)</span></p>
<ul>
<li>A cell currently on fire has its fuel level drop by <span class="arithmatex">\(1\)</span> after each time step until it runs out of fuel</li>
</ul>
<p>Users can configure <span class="arithmatex">\(\mu\)</span> and <span class="arithmatex">\(\sigma\)</span>. By defualt, their respective values are <span class="arithmatex">\(\mu=8.5\)</span> and <span class="arithmatex">\(\sigma=\sqrt 3\)</span></p>
<h4 id="fire-spread">Fire Spread</h4>
<p>We define the spread of the fire by the following equation: <span class="arithmatex">\(p(s)=1-\Pi_{s'}(1 - \lambda \cdot d(s,s') \cdot B(s'))\)</span></p>
<ul>
<li><span class="arithmatex">\(p(s)\)</span> represents the probability of non-inflamed cell <span class="arithmatex">\(s\)</span> alighting</li>
<li><span class="arithmatex">\(s'\)</span> represents an adjacent cell</li>
<li><span class="arithmatex">\(\lambda\)</span> is a hyperparameter that affects the probability of fire spreading from one cell to an adjacent one</li>
<li><span class="arithmatex">\(d(s,s')\)</span> is the Euclidean distance between cells</li>
<li><span class="arithmatex">\(B(s)\)</span> is a Boolean to check if cell is currently on fire</li>
</ul>
<p>Users can configure <span class="arithmatex">\(\lambda\)</span>. By defualt, the value is <span class="arithmatex">\(\lambda=0.094\)</span>.</p>
<h4 id="wind">Wind</h4>
<p>The spread of wildfire is also influenced by wind. This bias is modeled through a linear transformation using two properties. First, the wind speed affects the probability of neighboring cells igniting the current cell. In addition, for each cell, we calculate the vectors that point in the direction of each neighboring cell. We then take the dot product between this vector and the direction of the wind.</p>
<h2 id="custom-map-generation">Custom Map Generation</h2>
<h3 id="how-to-load-and-generate-maps">How to Load and Generate Maps</h3>
<p>To generate and load maps, the two functions of note are <code>generate_map_info</code> and <code>load_map_info</code> located within the <code>create_map_info.py</code> file in the <code>map_helpers</code> directory. </p>
<p>For the <code>generate_map_info</code> function, the main parameters that the user must provide are the size of the grid -- in terms of the number of rows (<code>num_rows</code>) and the number of columns (<code>num_cols</code>) -- and the number of populated cells the user would like the map to have (<code>num_populated_areas</code>). The maps are saved automatically, but this behavior can be turned off by setting the <code>save_map</code> parameter to <code>False</code>. Furthermore, the number of steps that are taken each iteration (every time a direction is chosen) are randomly chosen in the range stipulated by <code>steps_lower_bound</code> and <code>steps_upper_bound</code> which are 2 and 4 by default. The standard behavior of the map generation is to favor going straight <span class="arithmatex">\(50\)</span>% of the time, but this behavior can be changed by altering the <code>percent_go_straight</code> parameter. The number of paths generated for each populated area are also selected from a normal distribution with a mean of <span class="arithmatex">\(3\)</span> and standard deviation of <span class="arithmatex">\(1\)</span>, but these values can be altered by specifying the <code>num_paths_mean</code> and <code>num_paths_stdev</code> parameters. </p>
<p>If the <code>save_map</code> parameter is set to <code>True</code> when generating maps (the default behavior), the map is saved to the user’s current working directory by first creating a new subdirectory called <code>pyrorl_map_info</code> which stores all the subdirectories created for each subsequent map generation. For a given map generation, a new subdirectory is created within the <code>pyrorl_map_info</code> folder that is titled with the timestamp of when the map was created. Within this folder is a text file that is present for the user to easily see the number of rows, number of columns, and number of populated areas for the generation. This folder also contains pickle files that store the <code>populated_areas</code> array, <code>paths</code> array, <code>paths_to_pops</code> array, and a list that contains the number of rows, number of columns, and number of populated areas. </p>
<p>To load in a map, the path for the directory containing the relevant map information must be provided to the <code>load_map_info</code> function (by default, the title of the directory will by a timestamp). This function will then return the number of rows, the number of columns, the <code>populated_areas</code> array, the <code>paths</code> array, the <code>paths_to_pops</code> array, and the number of populated areas. </p>
<h3 id="deep-dive-on-map-generation-implementation">Deep Dive on Map Generation Implementation</h3>
<p>As a quick note, know that paths are allowed to overlap with each other and that paths can proceed through other populated areas.</p>
<p>In terms of the actual implementation of the map generation code, the populated areas are first randomly generated on the grid. These populated areas cannot be generated on the edge of the grid. Once the populated areas are selected, the number of paths for each area are then selected from a normal distribution with the mean and standard deviation taken from the provided parameters. </p>
<p>Each path is then generated for their respective populated area. Each path is generated starting from the coordinates of their respective populated areas. When creating a path, orientation and direction lie at the heart of the generation. Orientation is the cardinal direction an individual would be facing if they were to walk straight along the path, with north pointing to the top of the map (lower values of rows), south pointing to the bottom of the map (higher values of rows), east pointing to the right of the map (higher values of columns), and west pointing to the left of the map (lower values of columns). At the start of the map generation, the beginning orientation is selected randomly. Direction refers to how a person would proceed if they were to continue walking along the path given their current orientation, with the three directions being left, right, and straight. To update a path, a direction is first chosen. Once a direction is chosen, the orientation is updated and the path is extended along the new orientation for a given number of steps which is randomly chosen as a value between a given lower bound and upper bound provided as a parameter (2 and 3 by default). This process continues until the path reaches the edge of the map. </p>
<p>As an example of a generation iteration, consider the current orientation being “east” and the number of steps being 3. If the direction chosen is straight, the path will continue to extend east 3 steps. If the direction chosen is left, the orientation will change to north and the path will extend north 3 steps. If the direction chosen is right, the orientation will change to south and the path will extend south 3 steps. </p>
<p>Lastly, the code was designed so that paths will not overlap/intersect with themselves, meaning that as the paths are generated they will continue to proceed outwards towards the edge of the map. This is achieved by noting the minimum and maximum row index and minimum and maximum column index that the path has reached so far. There are then some special restrictions for each orientation on whether or not they can turn left or right (i.e. not proceed straight). If the orientation is north, then to take a turn the horizon (i.e. edge) of the path must currently be the minimum row index. If the orientation is south, then to take a turn the horizon (i.e. edge) of the path must currently be the maximum row index. If the orientation is east, then to take a turn the horizon (i.e. edge) of the path must currently be the maximum column index. If the orientation is west, then to take a turn the horizon (i.e. edge) of the path must currently be the minimum column index. </p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../quickstart/" class="btn btn-neutral float-left" title="Quickstart"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../contribution-guide/" class="btn btn-neutral float-right" title="Contribution Guide">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../quickstart/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../contribution-guide/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../javascripts/mathjax.js"></script>
      <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
